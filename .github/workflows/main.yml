#!/bin/bash

# Aktualizacja systemu
sudo apt update && sudo apt upgrade -y

# Instalacja podstawowych narzÄ™dzi
sudo apt install -y \
    git \
    curl \
    wget \
    nginx \
    redis-server \
    mysql-server \
    ufw \
    fail2ban \
    certbot \
    python3-certbot-nginx \
    htop \
    neofetch

# Instalacja Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# Instalacja PM2
sudo npm install -y pm2 -g
pm2 startup systemd
sudo env PATH=$PATH:/usr/bin pm2 startup systemd -u $USER --hp /home/$USER

# Instalacja Composera (PHP)
php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
php composer-setup.php --install-dir=/usr/local/bin --filename=composer
php -r "unlink('composer-setup.php');"

# Instalacja Dockera (opcjonalnie)
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# Konfiguracja firewall
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw --force enable

# Konfiguracja SSH
sudo sed -i 's/#Port 22/Port 22/' /etc/ssh/sshd_config
sudo sed -i 's/PermitRootLogin yes/PermitRootLogin prohibit-password/' /etc/ssh/sshd_config
sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
sudo systemctl restart sshd

# UtwÃ³rz katalogi
sudo mkdir -p /var/www/aplikacja
sudo mkdir -p /backups
sudo chown -R $USER:$USER /var/www/aplikacja
sudo chown -R $USER:$USER /backups

# Klonuj repozytorium (pierwszy raz)
cd /var/www/aplikacja
git clone https://github.com/twoja-nazwa/twoje-repo.git .

echo "âœ… VPS skonfigurowany pomyÅ›lnie!"
echo "ðŸ”‘ Dodaj klucz publiczny do ~/.ssh/authorized_keys"
